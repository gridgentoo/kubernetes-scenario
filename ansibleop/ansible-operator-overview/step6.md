Thus far, we have created the memcached-operator project specifically for watching the Memcached resource with APIVersion 'cache.example.com/v1apha1' and Kind 'Memcached'.  Now it's time to define the Operator logic.

## Customize the Operator logic

For this example the memcached-operator will execute the following
reconciliation logic for each 'Memcached' Custom Resource (CR):
- Create a memcached Deployment if it doesn't exist
- Ensure that the Deployment size is the same as specified by the 'Memcached'
CR

## Installing an existing Role from Ansible Galaxy

To speed development of our Operator up, we can reuse an existing Role. We will install a Role from Ansible Galaxy into our Operator: 

[dymurray.memcached_operator_role (galaxy.ansible.com)](https://galaxy.ansible.com/dymurray/memcached_operator_role)

Run to install the Ansible Role inside of the project:

`ansible-galaxy install dymurray.memcached_operator_role -p ./roles`{{execute}}

```
$ ls roles/
dymurray.memcached_operator_role Memcached
```

## Removing the unneeded Role
Since we'll be reusing the logic from 'dymurray.memcached_operator_role', we can safely delete the placeholder Role generated by the the 'operator-sdk new' command we ran previously.

`rm -rf ./roles/memcached`{{execute}}


## Taking a Closer Look: dymurray.memcached_operator_role

We can use the 'tree' command to get a general sense of the memcached Role installed from Ansible Galaxy.

`tree roles/dymurray.memcached_operator_role`{{execute}}


### Role Variables
This Role provides the user with a variable `size` which is an integer to
control the number of Deployment replicas to create. You can find the default for this variable in the memcached Role _defaults/main.yml_ file:

```
---
# defaults file for Memcached
size: 1
```

### Role Tasks
Be sure to examine the memcached Role _tasks/main.yml_ file, which uses the [_k8s_ (Kubernetes) Ansible module](https://docs.ansible.com/ansible/latest/modules/k8s_module.html)
 to create a Deployment of memcached.
```yaml
---
# tasks file for Memcached
- name: start memcached
  k8s:
    definition:
      kind: Deployment
      apiVersion: apps/v1
      metadata:
        name: '{{ meta.name }}-memcached'
        namespace: '{{ meta.namespace }}'
      spec:
        replicas: "{{size}}"
        selector:
          matchLabels:
            app: memcached
  
  [ ... continued ...]

```

Next, we'll modify the necessary files to ensure that our Operator
uses this Role instead of the generated scaffolding Role. Let's
modify `watches.yaml`.

## Correcting the Watches File

By default, the memcached-operator watches `Memcached` resource events as shown
in `watches.yaml` and executes Ansible Role `Memcached`. 

Since we have swapped out the original Role for one from Ansible Galaxy, lets change the Watches file to reflect this:

<pre class="file">
---
- version: v1alpha1
  group: cache.example.com
  kind: Memcached
  role: /opt/ansible/roles/dymurray.memcached_operator_role
  
</pre>

Update this file by running the following command:

```
wget -q https://raw.githubusercontent.com/openshift-labs/learn-katacoda/master/ansibleop/ansible-operator-overview/assets/watches.yaml -O /root/tutorial/memcached-operator/watches.yaml
```{{execute}}
<br>

In the next step, we'll build and run our Ansible Operator.
