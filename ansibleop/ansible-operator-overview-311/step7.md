Before running the Operator, Kubernetes needs to know about the new custom
resource definition the Operator will be watching.

### Deploy the Memcached Custom Resource Definition (CRD):

`oc create -f deploy/crds/cache_v1alpha1_memcached_crd.yaml`{{execute}}

By running this command, we are creating a new resource type, `memcached`, on the cluster. __We will give our Operator work to do by creating and modifying resources of this type.__

## Ways to Run an Operator

Once the CRD is registered, there are two ways to run the Operator:

* As a pod inside an Openshift cluster
* As a go program outside the cluster using operator-sdk

For the sake of this tutorial, we will run the Operator as a pod inside of a
Openshift Cluster. If you are interested in learning more about running the
Operator using operator-sdk, see the `up local` instructions in Step 9 of this scenario.

### Run as a pod inside an Openshift cluster

Running as a pod inside a Openshift cluster is preferred for production use.

Let's build the memcached-operator image:

`operator-sdk build memcached-operator:v0.0.1`{{execute}}

#### Modifying the Operator deploy manifest
Kubernetes deployment manifests are generated by 'operator-sdk new' in `deploy/operator.yaml`. We need to make a few changes to this file.

 - `image` placeholder 'REPLACE_IMAGE' should be set to the previously-built image.
 - `imagePullPolicy` from 'Always' to 'Never' since we aren't pushing our image to a registry.

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: memcached-operator
spec:
# [...]
      containers:
        - name: memcached-operator
          # Replace 'REPLACE_IMAGE' with the built image name
          image: REPLACE_IMAGE
          # Replace 'Always' with 'Never'
          imagePullPolicy: Always
# [...]
```

The commands below will change the Deployment 'image' and 'imagePullPolicy' respectively.

`sed -i 's|{{ REPLACE_IMAGE }}|memcached-operator:v0.0.1|g' deploy/operator.yaml`{{execute}}

`sed -i "s|{{ pull_policy\|default('Always') }}|Never|g" deploy/operator.yaml`{{execute}}

### Creating the Operator from deploy manifests
Now, we are ready to deploy the memcached-operator:

Create a Project for the Operator to run in
`oc new-project tutorial`{{execute}}

Create Service Account for Operator to run as
`oc create -f deploy/service_account.yaml`{{execute}}

Create OpenShift Role specifying Operator Permissions
`oc create -f deploy/role.yaml`{{execute}}

Create OpenShift Role Binding assigning Permissions to Service Account
`oc create -f deploy/role_binding.yaml`{{execute}}

Create Operator Deployment Object
`oc create -f deploy/operator.yaml`{{execute}}

*Note:* role.yaml and role_binding.yaml describe cluster-wide
resources. Creating these requires elevated permissions.



### Verify that the memcached-operator is running

`oc get deployment`{{execute}}

<small>
```sh
NAME                DESIRED CURRENT UP-TO-DATE AVAILABLE AGE
memcached-operator  1       1       1          1         1m
```
</small>
