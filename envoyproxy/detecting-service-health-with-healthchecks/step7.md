В отличие от активной проверки работоспособности **health checking**, обнаружение выбросов *Outlier Detection*  (иногда называемое пассивной проверкой работоспособности **passive health checking**) использует ответы от реальных запросов, чтобы определить, исправна ли конечная точка **endpoint is healthy**. После удаления конечной точки **endpoint is removed** Envoy использует подход, основанный на тайм-ауте, для повторной вставки, при котором неработоспособные хосты повторно добавляются в кластер после настраиваемого интервала. При каждом последующем удалении интервал увеличивается, поэтому постоянно неработоспособная конечная точка **unhealthy endpoint** наносит минимальный ущерб пользовательскому трафику **user traffic**.

Как и проверки работоспособности **health checks**, обнаружение выбросов настраивается для каждого кластера. Эта конфигурация удаляет хост на 30 секунд, когда он возвращает 3 раз последовательно **5xx errors**:

Откройте файл `envoy1.yaml`{{open}} и добавьте следующую конфигурацию:

<pre class="file" data-filename="envoy1.yaml" data-target="append">
    outlier_detection:
        consecutive_5xx: "3"
        base_ejection_time: "30s"
</pre>

Ключевые поля **key fields**:

* **sequence_5xx**: если **upstream host** возвращает некоторое количество последовательных 5xx, он будет удален. 
Обратите внимание, что в этом случае **5xx** означает фактический код ответа **5xx** или событие, которое заставит маршрутизатор HTTP вернуть его от имени потока **upstream’s behalf (reset, connection failure, etc.)**.

* **base_ejection_time**: базовое время, в течение которого хост **ejected**. Реальное время равно базовому времени, умноженному на количество раз, когда хост был удален. По умолчанию **30000ms or 30s**.

Более подробную информацию об API можно найти в [Envoy documentation](https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/cluster/outlier_detection.proto).
