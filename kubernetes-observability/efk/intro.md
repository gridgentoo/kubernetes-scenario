# Kubernetes and Logging #

Этот сценарий ознакомит вас с основами деплоя и логгирования в KUBERNETES. 
Предполагается, что все логги, генерируемые контейнерами, объединяются в центральное хранилище данных DATASTORE. Из этого datastore запросы и фильтры создают [Вьюхи - views] из агрегированных логгов.

Контейнеры должны создавать логги (logs), только в виде потоков событий (event streams) и оставлять агрегацию и маршрутизацию (aggregation and routing) для других служб в Kubernetes. 
Этот паттерн подчеркивается как фактор [11 Logs](https://12factor.net/logs) методологии [Приложение «Двенадцать факторов» (https://12factor.net/).

Обычно три компонента ElasticSearch, Fluentd и Kibana (EFK) объединяются для стека. Иногда в стеке используется Fluent Bit вместо Fluentd. Fluent Bit в основном функционально одинаков, но легче по своим характеристикам и размеру. Другие решения иногда используют Logstash (ELK) вместо Fluentd.

В следующих шагах вы узнаете:

- Как развернуть ElasticSearch, Fluentd и Kibana
- Как создать log events и query, в Kibana

## Forwarding: Fluent Bit ##

![Fluent Bit](/kuber-ru/courses/elk/efk/assets/flb_002.png "fluent Bit")
<div style="text-align: right">- fluentbit.io</div>

[Fluentd] (https://www.fluentd.org/) - это сборщик данных data collector с открытым исходным кодом, который позволяет унифицировать сбор data collection и использование данных для лучшего использования и понимания данных. В этом стеке Fluent Bit запускается на каждом узле (DaemonSet) и собирает все Логги из /var/logs и направляет их в ElasticSearch.

В этом примере может использоваться более легкая версия Fluentd, которая называется [Fluent Bit](https://fluentbit.io/). Возможно, EfK, в нижнем регистре 'f', кстати. 
[Alen Komljen](https://akomljen.com/) раскрывает причину этого в своем [блоге](https://akomljen.com/get-kubernetes-logs-with-efk-stack-in-5-minutes/).

Другой вариант ведения логгов - это стек E**L**K , который включает Logstash в качестве замены Fluent для решения задач агрегации логгов.

## Aggregation: ElasticSearch ##

Elasticsearch - это поисковая система, search engine, основанная на библиотеке Lucene. Он предоставляет распределенную полнотекстовую поисковую систему, full-text search engine, с поддержкой HTTP web interface и schema-free JSON documents.

## Viewing: Kibana ##

[Kibana](https://www.elastic.co/products/kibana) - это плагин для визуализации данных с открытым исходным кодом для Elasticsearch. Он предоставляет возможности визуализации поверх содержимого, проиндексированного в кластере Elasticsearch. Пользователи могут создавать линейчатые, линейные и точечные графики или круговые диаграммы и карты поверх больших объемов данных.

Для Kubernetes существует множество способов собрать EFK вместе, особенно с производственными или бизнес-критических кластеров. Некоторые решения могут использовать сервис ElasticSearch service вне кластера, возможно, предлагаемый облачным провайдером. Для любого решения, развернутого в Kubernetes, рекомендуется использовать Helm charts. Даже с Helm charts существует множество решений, которые развиваются и конкурируют друг с другом.

Тем не менее, этот сценарий призван показать, как можно разумно упростить наращивание EFK-стека, чтобы вы могли видеть, как компоненты установлены и работают друг с другом.
