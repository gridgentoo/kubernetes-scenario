<img align="right" width="400" src="./assets/chaos-mesh.png">

**Chaos Mesh** - это новый проект с открытым исходным кодом, запущенный в четвертом квартале 2019 года. Он наполнен многими экспериментальными функциями, которые вы ожидаете написать для тестирования **Chaos testing**. Проект находится в активной разработке как [проект песочницы с CNCF](https://www.cncf.io/sandbox-projects/). Этот сценарий Катакоды будет обновляться по мере развития.

**Chaos Mesh** - это облачная платформа для **Chaos Engineering**, которая оркестриует хаосом в средах **Kubernetes**. На текущем этапе она состоит из следующих компонентов:

-**Chaos Operator**: основной компонент для оркестровки хаоса.  

-**Chaos Operator** имеет полностью открытый код.  

-**Chaos Dashboard**: веб-интерфейс для управления, проектирования и мониторинга экспериментов с хаосом; в разработке.


**Chaos Mesh** - это универсальное решение для создания хаоса **chaos engineering**, которое включает в себя методы всестороннего внедрения ошибок **fault injection** для сложных систем в **Kubernetes**, охватывающих сбои в Подах, **faults** в сети, **faults** файловой системе и даже ядре **kernel Linux**.

**Chaos Mesh** - один из лучших двигателей хаоса **chaos engines** для **Kubernetes**, потому что:

1. За короткое время была сильная поддержка сообщества **community** и проект песочницы **CNCF sandbox project**.
1. Это **native experience** в Kubernetes, использует собственный **Operator Pattern** и **CRDs**, разрешающий **IaC** с вашими **pipelines**.
1. Если вы будете следовать лучшим практикам **best practices**, применяя множество меток **labels** и аннотаций **annotations** к вашим развертываниям, тогда нет необходимости вносить изменения в свои приложения для экспериментов с хаосом **chaos experiments**.
1. Существует множество разнообразных типов экспериментов, не только **Pod killing**.
1. Инсталлируйте с помощью **Helm chart**, и вы полностью контролируете **Chaos Engine** с помощью **CRDs**.

Не позволяйте названию проекта **_mesh_** ввести вас в заблуждение. Этот проект не имеет отношения к **_services meshes_**, как **Istio** и **Conduit**. 
Надеюсь, что в будущем они будут использовать функции **service mesh**, но пока они не связаны.

В этом сценарии вы узнаете, как:

- Инсталлируйте **Chaos Mesh** на **Kubernetes**.
- Инсталлируйте и маркируйте приложения **label applications,** чтобы сделать их подходящими целями для хаоса **Chaos Engineering**.
- Разрабатывайте и проводите эксперименты с хаосом **chaos experiments**.
- Наблюдайте за **chaos engine**, проводите свои эксперименты с кластерными объектами.
_

Исходный код на GitHub: 

https://github.com/chaos-mesh/chaos-mesh

**Chaos Mesh** состоит из двух компонентов **Chaos Operator** & **Chaos Dashboard** :

**Chaos Operator** — «оператор хаоса», основной компонент, который в свою очередь состоит из:

1. controller-manager (управляет Custom Resources),
1. chaos-daemon (привилегированный daemonset с возможностями управления сетью, cgroups и т.д.),
1. sidecar-контейнера, динамически вставляемогов целевой pod, чтобы вмешиваться в I/O целевого приложения.

**Chaos Dashboard** — веб-интерфейс для управления и мониторинга хаос-оператора

Проект входит в CNCF и разработан китайской компанией PingCAP, которая известна своей распределённой, Open Source, cloud-native SQL-базой данных для аналитики в реальном времени — **TiDB** (мы писали про её «собрата» — TiKV, — тоже входящего в число проектов CNCF).

Итак, «хаос-оператор» использует **CRD** для определения объектов хаоса. Всего их шесть типов: **PodChaos, NetworkChaos, IOChaos, TimeChaos, StressChaos и KernelChaos**. А вот какие доступны действия (эксперименты):

**pod-kill** — убийство pod'а;

**pod-failure**— недоступность pod'а некоторое (определённое) время;

**container-kill** — убийство одного из контейнеров pod'а;

**netem chaos** — сетевые проблемы, задержки, повторы пакетов;

**network-partition** — эмуляция распада сети на сегменты;

**IO chaos** — проблемы с диском и чтением/записью;

**time chaos** — искажение показателя текущего времени в pod'е;

**cpu-burn** — стресс CPU;

**memory-burn** — стресс памяти;

**kernel chaos** — жертва получит ошибки ядра, фрагментацию страниц памяти, проблемы с блочным I/O.

Объявляя любой из нужных нам **Custom Resource**, мы можем указать в нём типы действий, лейблы и селекторы для определения целевых namespace или конкретных **pod'ов**, а также длительность и расписание проведения экспериментов — в общем, всё необходимое для планирования «веселья».

Для изучения и демонстрации работы chaos-mesh подготовлен подробный мануал, в котором можно увидеть многочисленные возможности оператора. 

https://chaos-mesh.org/docs/user_guides/run_chaos_experiment/


С технической точки зрения, внутри репозитория (https://github.com/chaos-mesh/web-show) находится Deployment тестового приложения на **React** с сервисом, которому скриптом передаётся IP-адрес **pod'а** **kube-controller-manager** (первый из списка, если у нас мультимастер, или просто единственный). После запуска этот pod начинает непрерывно пинговать pod controller-manager'а и визуализировать на графике этот **ping**.
